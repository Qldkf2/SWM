<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="myPage">

	<!-- 회원 정보 수정 (사용자) -->
	<update id="updateMemberByUser" parameterType="com.ez.swm.login.vo.Member">
		update member
		set password = #{password}, nickName = #{nickName}, phone2 = #{phone2}, phone3 = #{phone3}, email = #{email}
		where userNo = #{userNo}
	</update>
	
	<!-- 회원 탈퇴 -->
	<update id="deleteMember" parameterType="com.ez.swm.login.vo.Member">
		update member
		set status = 'Y'
		where userId = #{userId} and password = #{password}
	</update>
	
	<!-- 1:1 문의 작성 -->
	<insert id="insertAsk" parameterType="com.ez.swm.myPage.vo.Ask">
		insert into ask(ask_no, userNo, ask_title, ask_content)
		values(seq_ask.nextval, #{userNo}, #{ask_title}, #{ask_content})
	</insert>
	
	<!-- 사용자 번호에 따른 1:1 문의 확인 -->
	<select id="getAskByUserNo" parameterType="int" resultType="com.ez.swm.myPage.vo.AskJoin">
		select a.ask_no, a.ask_title, a.ask_content, a.ask_date, m.userNo, m.nickName
		from ask a, member m
		where m.userNo = #{userNo} and a.userNo = m.userNo
		order by a.ask_no DESC
	</select>
	
	<!-- 1:1문의 상세보기  detail로 영역에 저장 -->
	<select id="askDetail" parameterType="int" resultType="com.ez.swm.myPage.vo.Ask">
		select *
		from ask
		where ask_no = #{ask_no}
	</select>
	
	<!-- 스터디카페 예약 정보 가져오기 -->
	<select id="getBookInfoList" parameterType="int" resultType="com.ez.swm.book.vo.UserBookVo">
		select m.userName, b.studycafe_name, b.booker_no, b.studycafe_room, b.permit_limit, b.book_date, b.start_time, b.end_time
		from member m, studycafe_book b
		where m.userNo=b.booker_no and b.booker_no = #{userNo}
	</select>
	
	<!-- 내가 만든 스터디 -->
	<select id="myCreateStudy" parameterType="int" resultType="com.ez.swm.meeting.vo.Meeting">
		SELECT * 
		FROM MEETING
		WHERE MEETING_LEADER = #{userNo}
	</select>
	<!-- 내가 가입한 스터디 -->
	<select id="myJoinStudy" parameterType="int" resultType="com.ez.swm.myPage.vo.MyJoinStudy">
		SELECT M.MEETING_NO,M.MEETING_LEADER,M.MEETING_AGE,M.MEETING_TITLE,
       M.MEETING_CONTENT,M.MEETING_ADDRESS,M.MEETING_SUBJECT,M.MEETING_LIMIT,
       M.STATUS,M.MEETING_DATE ,
    ( SELECT  PERMIT 
		FROM MEETING_PERMIT
		WHERE USERNO = #{userNo} AND PERMIT ='Y') AS PERMIT
    FROM MEETING M ,MEETING_PERMIT P
    WHERE m.MEETING_NO = P.MEETING_NO
 
	</select>
	
	<!-- 내가 쓴 글(스터디 모임 내 게시판) -->
	<select id="myStudyBoard" parameterType="int" resultType="com.ez.swm.myPage.vo.MyStudyBoard">
		select b.meeting_board_no, b.meeting_no, b.meeting_board_writer, b.meeting_board_title, b.meeting_board_content, 
			   b.meeting_board_date, m.meeting_title
		from meeting m, meeting_board b
		where meeting_board_writer = #{userNo} and m.meeting_no = b.meeting_no
	</select>
	
	
	
</mapper>