<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Meeting">

	<insert id="meetingWrite" parameterType="com.ez.swm.meeting.vo.MeetingWrite">
		<![CDATA[
		INSERT INTO MEETING VALUES(
			SEQ_MEETING_BOARD.NEXTVAl, #{meeting_leader}, #{meeting_age,jdbcType=VARCHAR}, #{meeting_title}, 
			#{meeting_content}, #{meeting_address} , #{meeting_subject}, #{meeting_limit} 
			,  DEFAULT , DEFAULT
		) 
		]]>
	</insert>
	
	<select id="getMeetingList" resultType="com.ez.swm.meeting.vo.MeetingList" >
		<![CDATA[	
			SELECT
	                m.NICKNAME,
					b.MEETING_NO,
					b.MEETING_TITLE,
					b.MEETING_AGE,
					b.MEETING_SUBJECT,
					b.MEETING_ADDRESS,
					b.MEETING_LEADER,
					b.MEETING_LIMIT,
					b.MEETING_DATE
				FROM
					MEETING b, MEMBER m
				WHERE
					b.STATUS = 'N' and m.userno=b.meeting_leader
				ORDER BY MEETING_NO DESC
		]]>
	</select>
	<select id="getMeetingArticle" resultType="com.ez.swm.meeting.vo.MeetingDetail"  parameterType="int">
		<![CDATA[	
			SELECT
	                m.NICKNAME,
	                b.MEETING_NO,
					b.MEETING_TITLE,
					b.MEETING_SUBJECT,
					b.MEETING_CONTENT,
					b.MEETING_ADDRESS,
					b.MEETING_LEADER,
					b.MEETING_LIMIT					
				FROM
					MEETING b, MEMBER m
				WHERE					
					b.MEETING_NO=#{MEETING_NO} and m.userno=b.meeting_leader

		]]>
	</select>
	
	<!-- 모임 가입하기 -->
	<insert id="meetingPermit" parameterType="com.ez.swm.meeting.vo.MeetingPermit">
		INSERT INTO MEETING_PERMIT VALUES(
			#{meeting_no}, #{userNo}, #{aboutMe} , #{permit}
		)
		
	</insert>
	
	<select id="getMeetingBoardList" resultType="com.ez.swm.meeting.vo.MeetingBoard" parameterType="int">
		<![CDATA[	
					SELECT 
						m.NICKNAME, 
						p.MEETING_BOARD_NO,
						p.MEETING_BOARD_WRITER,
						p.MEETING_BOARD_TITLE,
						p.MEETING_BOARD_DATE,
						p.MEETING_BOARD_HIT
					FROM 
						MEETING_BOARD p, Member m
					WHERE 
						p.MEETING_NO=#{MEETING_NO} and m.userno=p.MEETING_BOARD_WRITER and p.STATUS = 'N'
		]]>
	</select>
	
	<select id="getPartyBoardArticle" resultType="com.ez.swm.meeting.vo.MeetingBoard" parameterType="hashmap">
		<![CDATA[	
					SELECT 
						m.NICKNAME, 
						p.MEETING_BOARD_NO,
						p.MEETING_BOARD_WRITER,
						p.MEETING_NO,
						p.MEETING_BOARD_TITLE,
						p.MEETING_BOARD_CONTENT,
						p.MEETING_BOARD_DATE,
						p.MEETING_BOARD_HIT
					FROM 
						MEETING_BOARD p, Member m
					WHERE 
						p.MEETING_NO=#{MEETING_NO} and p.MEETING_BOARD_NO=#{MEETING_BOARD_NO} and m.userno=p.MEETING_BOARD_WRITER
		]]>
	</select>	
	
	<select id="getParty_no" resultType="int" >
		SELECT SEQ_MEETING_BOARD.CURRVAL FROM DUAL	
	</select>
	
	<insert id="insertPartyBoardArticle"  parameterType="com.ez.swm.meeting.vo.MeetingBoard" >
	  <![CDATA[
				INSERT 
					INTO MEETING_BOARD 
					VALUES(
						SEQ_MEETING_BOARD.NEXTVAL,
						#{meeting_no},
						#{meeting_board_writer},
						#{meeting_board_title},
						#{meeting_board_content},
						SYSDATE, '0', 'N'					
						)		
			]]>
		</insert>
	<!-- 모임 내 게시글 하나 불러오기 -->
	<select id="getMeetingBoard" resultType="com.ez.swm.meeting.vo.MeetingBoardModify">
		SELECT MEETING_BOARD_NO,  MEETING_NO, MEETING_BOARD_WRITER, MEETING_BOARD_TITLE, MEETING_BOARD_CONTENT , 
			   MEETING_BOARD_DATE, MEETING_BOARD_HIT
		FROM MEETING_BOARD
		WHERE MEETING_BOARD_NO = #{meeting_board_no}

	</select>
		<select id="getPartyBoardComment" resultType="com.ez.swm.meeting.vo.MeetingBoardComment" parameterType="int">
		<![CDATA[	
				SELECT 
				    m.NICKNAME,
				    p.MEETING_BOARD_COMMENT_NO,
				    p.MEETING_BOARD_NO,
				    p.USERNO,
				    p.MEETING_BOARD_COMMENT_CONTENT,
				    p.MEETING_BOARD_COMMENT_DATE,
				    p.MEETING_BOARD_COMMENT_LEVEL,
				    p.MEETING_BOARD_COMMENT_REFNO
				FROM MEETING_BOARD_COMMENT p, MEMBER m
				WHERE p.MEETING_BOARD_NO=#{PARTY_NO} AND m.userno=p.USERNO AND p.STATUS='N'
				ORDER BY p.MEETING_BOARD_COMMENT_REFNO ASC, p.MEETING_BOARD_COMMENT_LEVEL ASC
		]]>
	</select>
	
   <select id="getFileList" parameterType="int" resultType="com.ez.swm.meeting.vo.MeetingBoardFile" >
      <![CDATA[
         SELECT
            IDX,MEETING_BOARD_NO, STORED_FILE_NAME, ORIGINAL_FILE_NAME, ROUND(FILE_SIZE/1024,1) AS FILE_SIZE , DEL_GB
         FROM MEETING_BOARD_FILE
         WHERE MEETING_BOARD_NO = #{meeting_board_no} and DEL_GB = 'N'
      ]]>
   
   </select>
   
   <select id="getMeetingOne" resultType="com.ez.swm.meeting.vo.Meeting"  parameterType="int">
		<![CDATA[	
			SELECT *
			FROM MEETING
			WHERE MEETING_NO = #{meeting_no}
			
		]]>
	</select>
   
   	<update id="meetingUpdate" parameterType="com.ez.swm.meeting.vo.MeetingUpdate">
		UPDATE MEETING 
		SET MEETING_AGE = #{meeting_age}, MEETING_TITLE = #{meeting_title}, MEETING_CONTENT = #{meeting_content},
			MEETING_ADDRESS = #{meeting_address}, MEETING_SUBJECT = #{meeting_subject}, MEETING_LIMIT = #{meeting_limit}
		WHERE MEETING_NO = #{meeting_no}
	</update>
	
	<delete id="meetingDelete" parameterType="int" >
		DELETE FROM MEETING
		WHERE MEETING_NO = #{meeting_no}
	</delete>

	<!-- 모임 내 게시글 수정하기 -->
	<update id="meetingBoardModify" parameterType="com.ez.swm.meeting.vo.MeetingBoardModify">
		UPDATE MEETING_BOARD 
		SET MEETING_BOARD_TITLE = #{meeting_board_title}, MEETING_BOARD_CONTENT = #{meeting_board_content}
		WHERE MEETING_BOARD_NO = #{meeting_board_no}
	</update>
	
	<!-- 모임 내 게시글 삭제하기 -->
	<delete id="meetingBoardDelete" parameterType="int">
		DELETE FROM MEETING_BOARD
		WHERE MEETING_BOARD_NO = #{meeting_board_no}
	</delete>
	<!-- 신청한 사람들 리스트 불러오긴 -->
	<select id="meetingPermitList" resultType="com.ez.swm.meeting.vo.MeetingPermitList">
		SELECT P.MEETING_NO,P.USERNO, M.NICKNAME ,P.ABOUTME 
		FROM MEETING_PERMIT P JOIN MEMBER M
		ON P.USERNO = M.USERNO
		WHERE MEETING_NO = #{meeting_no} AND PERMIT ='N'
	</select>
</mapper>